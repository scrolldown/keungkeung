<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìœ„ì¹˜ ê¸°ë°˜ í¬í†  ì—…ë¡œë”</title>
    <meta name="description" content="ì‚¬ì§„ì„ ì—…ë¡œë“œí•˜ê³  ì§€ë„ì—ì„œ ìœ„ì¹˜ë¥¼ í™•ì¸í•˜ì„¸ìš”">
    <meta name="keywords" content="ì‚¬ì§„ì—…ë¡œë“œ, GPS, ì§€ë„, ìœ„ì¹˜ê¸°ë°˜, í¬í† ê°¤ëŸ¬ë¦¬">
    <meta name="author" content="keungkeung">
    <meta name="robots" content="index, follow">
    
    <!-- PWA ê´€ë ¨ ë©”íƒ€ë°ì´í„° -->
    <meta name="theme-color" content="#667eea">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="í¬í†  ì—…ë¡œë”">
    
    <!-- íŒŒë¹„ì½˜ -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ“¸</text></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ“¸</text></svg>">
    
    <!-- ì™¸ë¶€ ìŠ¤íƒ€ì¼ì‹œíŠ¸ -->
    <link rel="stylesheet" href="styles.css">
    
    <!-- í”„ë¦¬ë¡œë“œ ë¦¬ì†ŒìŠ¤ -->
    <link rel="preload" href="config.js" as="script">
    <link rel="preload" href="app.js" as="script">
</head>

<body>
    <!-- ===================== ë©”ì¸ ì»¨í…Œì´ë„ˆ ===================== -->
    <div class="container">
        <!-- í—¤ë” ì„¹ì…˜ -->
        <header class="header">
            <h1>ğŸ“¸ ìœ„ì¹˜ ê¸°ë°˜ í¬í†  ì—…ë¡œë”</h1>
            <p>ì‚¬ì§„ì„ ì—…ë¡œë“œí•˜ê³  ì§€ë„ì—ì„œ ìœ„ì¹˜ë¥¼ í™•ì¸í•˜ì„¸ìš”</p>
        </header>
        
        <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
        <nav class="tab-container" role="tablist">
            <button class="tab active" 
                    onclick="TabManager.showTab('upload')" 
                    role="tab" 
                    aria-selected="true" 
                    aria-controls="uploadTab">
                ğŸ“¤ ì—…ë¡œë“œ
            </button>
            <button class="tab" 
                    onclick="TabManager.showTab('map')" 
                    role="tab" 
                    aria-selected="false" 
                    aria-controls="mapTab">
                ğŸ—ºï¸ ì§€ë„
            </button>
        </nav>

        <!-- ì—…ë¡œë“œ íƒ­ -->
        <main id="uploadTab" class="tab-content active" role="tabpanel" aria-labelledby="upload-tab">
            <section class="upload-section">
                <!-- ì—…ë¡œë“œ ì˜ì—­ -->
                <div class="upload-area" id="uploadArea" role="button" tabindex="0" aria-label="íŒŒì¼ ì—…ë¡œë“œ ì˜ì—­">
                    <div class="upload-icon" aria-hidden="true">ğŸ“·</div>
                    <div class="upload-text">ì‚¬ì§„ì„ ì„ íƒí•˜ê±°ë‚˜ ë“œë˜ê·¸í•˜ì„¸ìš”</div>
                    <div class="upload-subtext">GPS ìœ„ì¹˜ ì •ë³´ê°€ ìë™ìœ¼ë¡œ ê¸°ë¡ë˜ê³  ì§€ë„ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</div>
                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="FileUploader.openCamera()" type="button">
                            ğŸ“· ì¹´ë©”ë¼
                        </button>
                        <button class="btn btn-secondary" onclick="FileUploader.openGallery()" type="button">
                            ğŸ–¼ï¸ ê°¤ëŸ¬ë¦¬
                        </button>
                    </div>
                </div>

                <!-- ìœ„ì¹˜ ì •ë³´ -->
                <div class="location-info" id="locationInfo" role="status" aria-live="polite">
                    <div>ğŸ“ í˜„ì¬ ìœ„ì¹˜: <span id="currentLocation">ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘...</span></div>
                </div>

                <!-- ìˆ¨ê²¨ì§„ íŒŒì¼ ì…ë ¥ -->
                <input type="file" 
                       id="fileInput" 
                       class="file-input" 
                       multiple 
                       accept="image/*" 
                       aria-label="ê°¤ëŸ¬ë¦¬ì—ì„œ ì´ë¯¸ì§€ ì„ íƒ">
                <input type="file" 
                       id="cameraInput" 
                       class="file-input" 
                       accept="image/*" 
                       capture="environment" 
                       aria-label="ì¹´ë©”ë¼ë¡œ ì‚¬ì§„ ì´¬ì˜">

                <!-- ì—…ë¡œë“œ ì§„í–‰ë¥  -->
                <div class="upload-progress" id="uploadProgress" role="progressbar" aria-live="polite">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div class="progress-text" id="progressText">ì—…ë¡œë“œ ì¤‘...</div>
                </div>

                <!-- ì„±ê³µ ë©”ì‹œì§€ -->
                <div class="success-message" id="successMessage" role="alert" aria-live="assertive">
                    âœ… ì‚¬ì§„ì´ ì„±ê³µì ìœ¼ë¡œ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!
                </div>

                <!-- ë¯¸ë¦¬ë³´ê¸° ì˜ì—­ -->
                <section class="preview-area" id="previewArea" aria-label="ì—…ë¡œë“œëœ ì‚¬ì§„ ë¯¸ë¦¬ë³´ê¸°"></section>
            </section>
        </main>

        <!-- ì§€ë„ íƒ­ -->
        <div id="mapTab" class="tab-content" role="tabpanel" aria-labelledby="map-tab">
            <div id="map" role="application" aria-label="ì‚¬ì§„ ìœ„ì¹˜ë¥¼ í‘œì‹œí•˜ëŠ” ì§€ë„">
                <div class="loading" id="mapLoading" role="status" aria-live="polite">
                    ğŸ—ºï¸ ì§€ë„ë¥¼ ë¡œë”©í•˜ëŠ” ì¤‘ì…ë‹ˆë‹¤...
                </div>
                
                <!-- ì§€ë„ ì»¨íŠ¸ë¡¤ -->
                <div class="map-controls" style="display: none;" id="mapControls" role="toolbar" aria-label="ì§€ë„ ì»¨íŠ¸ë¡¤">
                    <button class="map-btn" 
                            onclick="MapController.centerMap()" 
                            title="ë‚´ ìœ„ì¹˜ë¡œ ì´ë™" 
                            aria-label="ë‚´ ìœ„ì¹˜ë¡œ ì´ë™" 
                            type="button">
                        ğŸ“
                    </button>
                    <button class="map-btn" 
                            onclick="MapController.showAllPhotos()" 
                            title="ëª¨ë“  ì‚¬ì§„ì´ ë³´ì´ë„ë¡ í™•ëŒ€/ì¶•ì†Œ" 
                            aria-label="ëª¨ë“  ì‚¬ì§„ ë³´ê¸°" 
                            type="button">
                        ğŸ–¼ï¸
                    </button>
                    <button class="map-btn" 
                            onclick="MapController.showHelp()" 
                            title="ë„ì›€ë§" 
                            aria-label="ë„ì›€ë§ ë³´ê¸°" 
                            type="button">
                        â“
                    </button>
                </div>
                
                <!-- ì‚¬ì§„ íŒì—… ì˜¤ë²„ë ˆì´ -->
                <div class="photo-popup-overlay" 
                     id="photoPopupOverlay" 
                     onclick="PhotoPopup.close()" 
                     role="button" 
                     tabindex="0" 
                     aria-label="íŒì—… ë‹«ê¸°"></div>
                
                <!-- ì‚¬ì§„ íŒì—… -->
                <dialog class="photo-popup" id="photoPopup" role="dialog" aria-modal="true" aria-labelledby="popupTitle">
                    <button class="photo-popup-close" 
                            onclick="PhotoPopup.close()" 
                            type="button" 
                            aria-label="íŒì—… ë‹«ê¸°">Ã—</button>
                    <img id="popupImage" src="" alt="" loading="lazy">
                    <div class="photo-popup-content">
                        <div class="photo-popup-header">
                            <div>
                                <h3 class="photo-popup-title" id="popupTitle"></h3>
                                <div class="photo-popup-size" id="popupSize"></div>
                                <div class="photo-popup-location" id="popupLocation"></div>
                                <div class="photo-popup-time" id="popupTime"></div>
                            </div>
                        </div>
                        <div class="photo-popup-actions">
                            <button class="photo-popup-btn primary" 
                                    onclick="PhotoPopup.downloadPhoto()" 
                                    type="button" 
                                    aria-label="ì‚¬ì§„ ë‹¤ìš´ë¡œë“œ">
                                ğŸ“¥ ë‹¤ìš´ë¡œë“œ
                            </button>
                            <button class="photo-popup-btn secondary" 
                                    onclick="PhotoPopup.shareLocation()" 
                                    type="button" 
                                    aria-label="ìœ„ì¹˜ ì •ë³´ ê³µìœ ">
                                ğŸ“ ìœ„ì¹˜ ê³µìœ 
                            </button>
                        </div>
                    </div>
                </dialog>
            </div>
        </div>
    </div>

    <!-- ===================== ìŠ¤í¬ë¦½íŠ¸ ë¡œë”© ===================== -->
    
    <!-- ì—ëŸ¬ í•¸ë“¤ë§ -->
    <script>
        // ì „ì—­ ì—ëŸ¬ í•¸ë“¤ëŸ¬
        window.addEventListener('error', function(e) {
            console.error('ìŠ¤í¬ë¦½íŠ¸ ë¡œë”© ì˜¤ë¥˜:', e.filename, e.message);
        });
        
        // CSS ë¡œë”© í™•ì¸
        function checkCSSLoading() {
            const link = document.querySelector('link[href="styles.css"]');
            if (link) {
                link.onerror = function() {
                    console.error('styles.css íŒŒì¼ì„ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    // ì¸ë¼ì¸ ê¸°ë³¸ ìŠ¤íƒ€ì¼ ì ìš©
                    const style = document.createElement('style');
                    style.textContent = `
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        .container { max-width: 800px; margin: 0 auto; }
                        .header { background: #667eea; color: white; padding: 20px; text-align: center; }
                        .tab-container { display: flex; border-bottom: 1px solid #ddd; }
                        .tab { flex: 1; padding: 15px; background: white; border: none; cursor: pointer; }
                        .tab.active { color: #667eea; border-bottom: 3px solid #667eea; }
                        .tab-content { display: none; padding: 20px; }
                        .tab-content.active { display: block; }
                        .upload-area { border: 2px dashed #667eea; padding: 40px; text-align: center; margin: 20px 0; }
                        .btn { padding: 10px 20px; margin: 5px; border: none; border-radius: 5px; cursor: pointer; }
                        .btn-primary { background: #667eea; color: white; }
                        .btn-secondary { background: #f0f0f0; color: #333; }
                        #map { width: 100%; height: 400px; background: #f0f0f0; }
                    `;
                    document.head.appendChild(style);
                };
            }
        }
        
        checkCSSLoading();
    </script>
    
    <!-- ì„¤ì • íŒŒì¼ (ìš°ì„  ë¡œë”©) -->
    <script>
        // config.js ë¡œë”©
        function loadConfig() {
            const script = document.createElement('script');
            script.src = 'config.js';
            script.onload = function() {
                console.log('âœ… config.js ë¡œë“œ ì™„ë£Œ');
                loadApp();
            };
            script.onerror = function() {
                console.error('âŒ config.js ë¡œë“œ ì‹¤íŒ¨');
                alert('ì„¤ì • íŒŒì¼ì„ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
            };
            document.head.appendChild(script);
        }
        
        // ë©”ì¸ ì•± ë¡œë”©
        function loadApp() {
            const script = document.createElement('script');
            script.src = 'app.js';
            script.onload = function() {
                console.log('âœ… app.js ë¡œë“œ ì™„ë£Œ');
                loadGoogleMaps();
            };
            script.onerror = function() {
                console.error('âŒ app.js ë¡œë“œ ì‹¤íŒ¨');
                alert('ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
            };
            document.head.appendChild(script);
        }
        
        // Google Maps API ë¡œë”©
        function loadGoogleMaps() {
            // config.js ë¡œë“œ í™•ì¸
            if (typeof APP_CONFIG === 'undefined') {
                console.error('APP_CONFIGê°€ ì •ì˜ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                setTimeout(loadGoogleMaps, 100);
                return;
            }
            
            // Google Maps API ìŠ¤í¬ë¦½íŠ¸ ìƒì„±
            const script = document.createElement('script');
            script.src = `https://maps.googleapis.com/maps/api/js?key=${APP_CONFIG.GOOGLE_MAPS_API_KEY}&libraries=geometry&callback=initGoogleMaps`;
            script.async = true;
            script.defer = true;
            script.onerror = function() {
                console.error('âŒ Google Maps API ë¡œë”© ì‹¤íŒ¨');
                alert('ì§€ë„ ì„œë¹„ìŠ¤ë¥¼ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. API í‚¤ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.');
            };
            document.head.appendChild(script);
        }
        
        // DOM ë¡œë“œ ì™„ë£Œ í›„ ì‹œì‘
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', loadConfig);
        } else {
            loadConfig();
        }
    </script>

    <!-- ì„œë¹„ìŠ¤ ì›Œì»¤ ë“±ë¡ (PWA - ì„ íƒì‚¬í•­) -->
    <script>
        // ì„œë¹„ìŠ¤ ì›Œì»¤ ì§€ì› í™•ì¸ ë° ë“±ë¡
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                // ì„œë¹„ìŠ¤ ì›Œì»¤ íŒŒì¼ì´ ìˆë‹¤ë©´ ë“±ë¡
                // navigator.serviceWorker.register('/sw.js')
                //     .then(registration => console.log('SW registered'))
                //     .catch(error => console.log('SW registration failed'));
            });
        }
    </script>

    <!-- ì›¹ ì•± ë§¤ë‹ˆí˜ìŠ¤íŠ¸ (PWA - ì„ íƒì‚¬í•­) -->
    <!-- <link rel="manifest" href="/manifest.json"> -->
</body>
</html>
