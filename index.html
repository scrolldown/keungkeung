<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìœ„ì¹˜ ê¸°ë°˜ í¬í†  ì—…ë¡œë”</title>
    <meta name="description" content="ì‚¬ì§„ì„ ì—…ë¡œë“œí•˜ê³  ì§€ë„ì—ì„œ ìœ„ì¹˜ë¥¼ í™•ì¸í•˜ì„¸ìš”">
    <meta name="keywords" content="ì‚¬ì§„ì—…ë¡œë“œ, GPS, ì§€ë„, ìœ„ì¹˜ê¸°ë°˜, í¬í† ê°¤ëŸ¬ë¦¬">
    <meta name="author" content="keungkeung">
    <meta name="robots" content="index, follow">
    
    <!-- PWA ê´€ë ¨ ë©”íƒ€ë°ì´í„° -->
    <meta name="theme-color" content="#667eea">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="í¬í†  ì—…ë¡œë”">
    
    <!-- íŒŒë¹„ì½˜ -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ“¸</text></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ“¸</text></svg>">
    
    <!-- ì™¸ë¶€ ìŠ¤íƒ€ì¼ì‹œíŠ¸ -->
    <link rel="stylesheet" href="styles.css">
    
    <!-- í”„ë¦¬ë¡œë“œ ë¦¬ì†ŒìŠ¤ -->
    <link rel="preload" href="config.js" as="script">
    <link rel="preload" href="app.js" as="script">
</head>

<body>
    <!-- ===================== ë©”ì¸ ì»¨í…Œì´ë„ˆ ===================== -->
    <div class="container">
        <!-- í—¤ë” ì„¹ì…˜ -->
        <header class="header">
            <h1>ğŸ“¸ ìœ„ì¹˜ ê¸°ë°˜ í¬í†  ì—…ë¡œë”</h1>
            <p>ì‚¬ì§„ì„ ì—…ë¡œë“œí•˜ê³  ì§€ë„ì—ì„œ ìœ„ì¹˜ë¥¼ í™•ì¸í•˜ì„¸ìš”</p>
        </header>
        
        <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
        <nav class="tab-container" role="tablist">
            <button class="tab active" 
                    onclick="TabManager.showTab('upload')" 
                    role="tab" 
                    aria-selected="true" 
                    aria-controls="uploadTab">
                ğŸ“¤ ì—…ë¡œë“œ
            </button>
            <button class="tab" 
                    onclick="TabManager.showTab('map')" 
                    role="tab" 
                    aria-selected="false" 
                    aria-controls="mapTab">
                ğŸ—ºï¸ ì§€ë„
            </button>
        </nav>

        <!-- ì—…ë¡œë“œ íƒ­ -->
        <main id="uploadTab" class="tab-content active" role="tabpanel" aria-labelledby="upload-tab">
            <section class="upload-section">
                <!-- ì—…ë¡œë“œ ì˜ì—­ -->
                <div class="upload-area" id="uploadArea" role="button" tabindex="0" aria-label="íŒŒì¼ ì—…ë¡œë“œ ì˜ì—­">
                    <div class="upload-icon" aria-hidden="true">ğŸ“·</div>
                    <div class="upload-text">ì‚¬ì§„ì„ ì„ íƒí•˜ê±°ë‚˜ ë“œë˜ê·¸í•˜ì„¸ìš”</div>
                    <div class="upload-subtext">GPS ìœ„ì¹˜ ì •ë³´ê°€ ìë™ìœ¼ë¡œ ê¸°ë¡ë˜ê³  ì§€ë„ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</div>
                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="FileUploader.openCamera()" type="button">
                            ğŸ“· ì¹´ë©”ë¼
                        </button>
                        <button class="btn btn-secondary" onclick="FileUploader.openGallery()" type="button">
                            ğŸ–¼ï¸ ê°¤ëŸ¬ë¦¬
                        </button>
                    </div>
                </div>

                <!-- ìœ„ì¹˜ ì •ë³´ -->
                <div class="location-info" id="locationInfo" role="status" aria-live="polite">
                    <div>ğŸ“ í˜„ì¬ ìœ„ì¹˜: <span id="currentLocation">ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘...</span></div>
                </div>

                <!-- ìˆ¨ê²¨ì§„ íŒŒì¼ ì…ë ¥ -->
                <input type="file" 
                       id="fileInput" 
                       class="file-input" 
                       multiple 
                       accept="image/*" 
                       aria-label="ê°¤ëŸ¬ë¦¬ì—ì„œ ì´ë¯¸ì§€ ì„ íƒ">
                <input type="file" 
                       id="cameraInput" 
                       class="file-input" 
                       accept="image/*" 
                       capture="environment" 
                       aria-label="ì¹´ë©”ë¼ë¡œ ì‚¬ì§„ ì´¬ì˜">

                <!-- ì—…ë¡œë“œ ì§„í–‰ë¥  -->
                <div class="upload-progress" id="uploadProgress" role="progressbar" aria-live="polite">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div class="progress-text" id="progressText">ì—…ë¡œë“œ ì¤‘...</div>
                </div>

                <!-- ì„±ê³µ ë©”ì‹œì§€ -->
                <div class="success-message" id="successMessage" role="alert" aria-live="assertive">
                    âœ… ì‚¬ì§„ì´ ì„±ê³µì ìœ¼ë¡œ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!
                </div>

                <!-- ë¯¸ë¦¬ë³´ê¸° ì˜ì—­ -->
                <section class="preview-area" id="previewArea" aria-label="ì—…ë¡œë“œëœ ì‚¬ì§„ ë¯¸ë¦¬ë³´ê¸°"></section>
            </section>
        </main>

        <!-- ì§€ë„ íƒ­ -->
        <div id="mapTab" class="tab-content" role="tabpanel" aria-labelledby="map-tab">
            <div id="map" role="application" aria-label="ì‚¬ì§„ ìœ„ì¹˜ë¥¼ í‘œì‹œí•˜ëŠ” ì§€ë„">
                <div class="loading" id="mapLoading" role="status" aria-live="polite">
                    ğŸ—ºï¸ ì§€ë„ë¥¼ ë¡œë”©í•˜ëŠ” ì¤‘ì…ë‹ˆë‹¤...
                </div>
                
                <!-- ì§€ë„ ì»¨íŠ¸ë¡¤ -->
                <div class="map-controls" style="display: none;" id="mapControls" role="toolbar" aria-label="ì§€ë„ ì»¨íŠ¸ë¡¤">
                    <button class="map-btn" 
                            onclick="MapController.centerMap()" 
                            title="ë‚´ ìœ„ì¹˜ë¡œ ì´ë™" 
                            aria-label="ë‚´ ìœ„ì¹˜ë¡œ ì´ë™" 
                            type="button">
                        ğŸ“
                    </button>
                    <button class="map-btn" 
                            onclick="MapController.showAllPhotos()" 
                            title="ëª¨ë“  ì‚¬ì§„ì´ ë³´ì´ë„ë¡ í™•ëŒ€/ì¶•ì†Œ" 
                            aria-label="ëª¨ë“  ì‚¬ì§„ ë³´ê¸°" 
                            type="button">
                        ğŸ–¼ï¸
                    </button>
                    <button class="map-btn" 
                            onclick="MapController.showHelp()" 
                            title="ë„ì›€ë§" 
                            aria-label="ë„ì›€ë§ ë³´ê¸°" 
                            type="button">
                        â“
                    </button>
                </div>
                
                <!-- ì‚¬ì§„ íŒì—… ì˜¤ë²„ë ˆì´ -->
                <div class="photo-popup-overlay" 
                     id="photoPopupOverlay" 
                     onclick="PhotoPopup.close()" 
                     role="button" 
                     tabindex="0" 
                     aria-label="íŒì—… ë‹«ê¸°"></div>
                
                <!-- ì‚¬ì§„ íŒì—… -->
                <dialog class="photo-popup" id="photoPopup" role="dialog" aria-modal="true" aria-labelledby="popupTitle">
                    <button class="photo-popup-close" 
                            onclick="PhotoPopup.close()" 
                            type="button" 
                            aria-label="íŒì—… ë‹«ê¸°">Ã—</button>
                    <img id="popupImage" src="" alt="" loading="lazy">
                    <div class="photo-popup-content">
                        <div class="photo-popup-header">
                            <div>
                                <h3 class="photo-popup-title" id="popupTitle"></h3>
                                <div class="photo-popup-size" id="popupSize"></div>
                                <div class="photo-popup-location" id="popupLocation"></div>
                                <div class="photo-popup-time" id="popupTime"></div>
                            </div>
                        </div>
                        <div class="photo-popup-actions">
                            <button class="photo-popup-btn primary" 
                                    onclick="PhotoPopup.downloadPhoto()" 
                                    type="button" 
                                    aria-label="ì‚¬ì§„ ë‹¤ìš´ë¡œë“œ">
                                ğŸ“¥ ë‹¤ìš´ë¡œë“œ
                            </button>
                            <button class="photo-popup-btn secondary" 
                                    onclick="PhotoPopup.shareLocation()" 
                                    type="button" 
                                    aria-label="ìœ„ì¹˜ ì •ë³´ ê³µìœ ">
                                ğŸ“ ìœ„ì¹˜ ê³µìœ 
                            </button>
                        </div>
                    </div>
                </dialog>
            </div>
        </div>
    </div>
<!-- ===================== ìŠ¤í¬ë¦½íŠ¸ ë¡œë”© (ìˆ˜ì •ë¨) ===================== -->
    
    <!-- ì—ëŸ¬ í•¸ë“¤ë§ ë° ê¸°ë³¸ ì„¤ì • -->
    <script>
        // ì „ì—­ ì—ëŸ¬ í•¸ë“¤ëŸ¬ (ê°€ì¥ ë¨¼ì € ì„¤ì •)
        window.addEventListener('error', function(e) {
            console.error('ğŸš¨ ìŠ¤í¬ë¦½íŠ¸ ë¡œë”© ì˜¤ë¥˜:', e.filename, e.message, e.lineno, e.colno);
            
            // íŠ¹ì • ì˜¤ë¥˜ì— ëŒ€í•œ ì‚¬ìš©ì ì•Œë¦¼
            if (e.filename && e.filename.includes('config.js')) {
                setTimeout(() => {
                    if (typeof APP_CONFIG === 'undefined') {
                        console.error('config.js ë¡œë”© ì‹¤íŒ¨ - ê¸°ë³¸ ì„¤ì •ìœ¼ë¡œ ëŒ€ì²´');
                    }
                }, 100);
            }
        });
        
        // Google Maps API ì½œë°± í•¨ìˆ˜ (ê°€ì¥ ë¨¼ì € ì •ì˜)
        window.initGoogleMaps = function() {
            console.log('ğŸ—ºï¸ Google Maps API ë¡œë“œ ì™„ë£Œ');
            
            // MapControllerê°€ ë¡œë“œë˜ì—ˆëŠ”ì§€ í™•ì¸
            if (typeof window.MapController !== 'undefined') {
                const mapTab = document.getElementById('mapTab');
                if (mapTab && mapTab.classList.contains('active')) {
                    window.MapController.init();
                }
            } else {
                console.log('MapController ë¡œë“œ ëŒ€ê¸° ì¤‘...');
                // MapController ë¡œë“œ ëŒ€ê¸°
                let checkInterval = setInterval(() => {
                    if (typeof window.MapController !== 'undefined') {
                        clearInterval(checkInterval);
                        const mapTab = document.getElementById('mapTab');
                        if (mapTab && mapTab.classList.contains('active')) {
                            window.MapController.init();
                        }
                        console.log('MapController ë¡œë“œ ì™„ë£Œ - ì§€ë„ ì¤€ë¹„ë¨');
                    }
                }, 100);
            }
        };
        
        // ì„ì‹œ ê¸°ë³¸ ê°ì²´ë“¤ (config.js ë¡œë“œ ì‹¤íŒ¨ ëŒ€ë¹„)
        window.tempConfig = {
            DEBUG_MODE: true,
            MAX_FILE_SIZE: 5 * 1024 * 1024,
            DEFAULT_LOCATION: { lat: 37.5665, lng: 126.9780 },
            DEFAULT_ZOOM: 15,
            APP_NAME: 'ìœ„ì¹˜ ê¸°ë°˜ í¬í†  ì—…ë¡œë”',
            APP_VERSION: '1.0.1',
            GOOGLE_MAPS_API_KEY: 'AIzaSyBgn5XdaAN2yorZSRkGhIDdUq-Ie87NsaU'
        };
        
        window.tempDevTools = {
            log: (msg, data) => console.log(`[TEMP] ${msg}`, data || ''),
            error: (msg, error) => console.error(`[TEMP] ${msg}`, error || ''),
            warn: (msg, data) => console.warn(`[TEMP] ${msg}`, data || ''),
            isReady: () => true
        };
    </script>
    
    <!-- ì„¤ì • íŒŒì¼ ë¡œë”© (ê°œì„ ë¨) -->
    <script>
        // config.js ë™ì  ë¡œë”© í•¨ìˆ˜
        function loadConfigScript() {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = 'config.js';
                script.onload = function() {
                    console.log('âœ… config.js ë¡œë“œ ì„±ê³µ');
                    
                    // ë¡œë“œ ê²€ì¦
                    if (typeof APP_CONFIG !== 'undefined' && typeof DEV_TOOLS !== 'undefined') {
                        console.log('âœ… ëª¨ë“  ì„¤ì • ê°ì²´ ë¡œë“œ ì™„ë£Œ');
                        resolve();
                    } else {
                        console.warn('âš ï¸ ì¼ë¶€ ì„¤ì • ê°ì²´ê°€ ëˆ„ë½ë¨');
                        // ëˆ„ë½ëœ ê°ì²´ë“¤ ê¸°ë³¸ê°’ìœ¼ë¡œ ëŒ€ì²´
                        if (typeof APP_CONFIG === 'undefined') {
                            window.APP_CONFIG = window.tempConfig;
                            console.log('APP_CONFIGë¥¼ ê¸°ë³¸ê°’ìœ¼ë¡œ ëŒ€ì²´');
                        }
                        if (typeof DEV_TOOLS === 'undefined') {
                            window.DEV_TOOLS = window.tempDevTools;
                            console.log('DEV_TOOLSë¥¼ ê¸°ë³¸ê°’ìœ¼ë¡œ ëŒ€ì²´');
                        }
                        resolve();
                    }
                };
                script.onerror = function(error) {
                    console.error('âŒ config.js ë¡œë“œ ì‹¤íŒ¨:', error);
                    // ê¸°ë³¸ ì„¤ì •ìœ¼ë¡œ ëŒ€ì²´
                    window.APP_CONFIG = window.tempConfig;
                    window.DEV_TOOLS = window.tempDevTools;
                    window.MESSAGES = {
                        LOCATION: {
                            LOADING: 'ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘...',
                            ERROR: 'ìœ„ì¹˜ ì •ë³´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤',
                            UNSUPPORTED: 'ìœ„ì¹˜ ì •ë³´ë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤.'
                        },
                        UPLOAD: {
                            SUCCESS: 'âœ… ì‚¬ì§„ì´ ì„±ê³µì ìœ¼ë¡œ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!',
                            INVALID_TYPE: 'ì€(ëŠ”) ì´ë¯¸ì§€ íŒŒì¼ì´ ì•„ë‹™ë‹ˆë‹¤.',
                            TOO_LARGE: 'ì˜ í¬ê¸°ê°€ 5MBë¥¼ ì´ˆê³¼í•©ë‹ˆë‹¤.',
                            UPLOADING: 'ì—…ë¡œë“œ ì¤‘...'
                        }
                    };
                    console.log('âš ï¸ ê¸°ë³¸ ì„¤ì •ìœ¼ë¡œ ì§„í–‰');
                    reject(error);
                };
                document.head.appendChild(script);
            });
        }
        
        // app.js ë™ì  ë¡œë”© í•¨ìˆ˜
        function loadAppScript() {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = 'app.js';
                script.onload = function() {
                    console.log('âœ… app.js ë¡œë“œ ì„±ê³µ');
                    resolve();
                };
                script.onerror = function(error) {
                    console.error('âŒ app.js ë¡œë“œ ì‹¤íŒ¨:', error);
                    alert('ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
                    reject(error);
                };
                document.head.appendChild(script);
            });
        }
        
        // Google Maps API ë¡œë”© í•¨ìˆ˜
        function loadGoogleMapsAPI() {
            // API í‚¤ í™•ì¸
            const apiKey = (window.APP_CONFIG && window.APP_CONFIG.GOOGLE_MAPS_API_KEY) || 
                           window.tempConfig.GOOGLE_MAPS_API_KEY;
            
            if (!apiKey || apiKey === 'YOUR_API_KEY_HERE') {
                console.error('âŒ Google Maps API í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                return;
            }
            
            console.log('ğŸ—ºï¸ Google Maps API ë¡œë”© ì‹œì‘...');
            
            const script = document.createElement('script');
            script.src = `https://maps.googleapis.com/maps/api/js?key=${apiKey}&libraries=geometry&callback=initGoogleMaps`;
            script.async = true;
            script.defer = true;
            script.onload = function() {
                console.log('ğŸ“¡ Google Maps ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì™„ë£Œ');
            };
            script.onerror = function() {
                console.error('âŒ Google Maps API ë¡œë”© ì‹¤íŒ¨ - API í‚¤ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”');
                // ì§€ë„ ì—†ì´ë„ ì—…ë¡œë“œ ê¸°ëŠ¥ì€ ì‚¬ìš© ê°€ëŠ¥í•˜ë„ë¡ í•¨
                const mapLoading = document.getElementById('mapLoading');
                if (mapLoading) {
                    mapLoading.innerHTML = 'âŒ ì§€ë„ë¥¼ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.<br>API í‚¤ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.';
                }
            };
            document.head.appendChild(script);
        }
        
        // ìˆœì°¨ì  ë¡œë”© ì‹¤í–‰
        async function initializeApplication() {
            try {
                // 1. config.js ë¡œë“œ (ì‹¤íŒ¨í•´ë„ ê³„ì† ì§„í–‰)
                try {
                    await loadConfigScript();
                } catch (configError) {
                    console.warn('config.js ë¡œë“œ ì‹¤íŒ¨í–ˆì§€ë§Œ ê¸°ë³¸ ì„¤ì •ìœ¼ë¡œ ê³„ì† ì§„í–‰');
                }
                
                // 2. app.js ë¡œë“œ
                await loadAppScript();
                
                // 3. Google Maps API ë¡œë“œ
                loadGoogleMapsAPI();
                
                console.log('ğŸš€ ëª¨ë“  ìŠ¤í¬ë¦½íŠ¸ ë¡œë”© ì™„ë£Œ');
                
            } catch (error) {
                console.error('âŒ ì• í”Œë¦¬ì¼€ì´ì…˜ ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                alert('ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹œì‘í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
            }
        }
        
        // DOM ë¡œë“œ ì™„ë£Œ í›„ ì‹œì‘
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeApplication);
        } else {
            initializeApplication();
        }
    </script>

    <!-- CSS ë¡œë”© í™•ì¸ -->
    <script>
        function checkCSSLoading() {
            const link = document.querySelector('link[href="styles.css"]');
            if (link) {
                link.onerror = function() {
                    console.error('âŒ styles.css íŒŒì¼ì„ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    // ê¸°ë³¸ ì¸ë¼ì¸ ìŠ¤íƒ€ì¼ ì ìš©
                    const style = document.createElement('style');
                    style.textContent = `
                        body { font-family: Arial, sans-serif; margin: 0; background: #f0f0f0; }
                        .container { max-width: 800px; margin: 0 auto; background: white; min-height: 100vh; }
                        .header { background: #667eea; color: white; padding: 20px; text-align: center; }
                        .tab-container { display: flex; border-bottom: 1px solid #ddd; }
                        .tab { flex: 1; padding: 15px; background: white; border: none; cursor: pointer; }
                        .tab.active { color: #667eea; border-bottom: 3px solid #667eea; }
                        .tab-content { display: none; padding: 20px; }
                        .tab-content.active { display: block; }
                        .upload-area { border: 2px dashed #667eea; padding: 40px; text-align: center; margin: 20px 0; border-radius: 10px; }
                        .btn { padding: 10px 20px; margin: 5px; border: none; border-radius: 5px; cursor: pointer; }
                        .btn-primary { background: #667eea; color: white; }
                        #map { width: 100%; height: 400px; background: #f0f0f0; display: flex; align-items: center; justify-content: center; }
                    `;
                    document.head.appendChild(style);
                    console.log('âš ï¸ ê¸°ë³¸ ìŠ¤íƒ€ì¼ ì ìš©ë¨');
                };
            }
        }
        
        checkCSSLoading();
    </script>
    <!-- ì›¹ ì•± ë§¤ë‹ˆí˜ìŠ¤íŠ¸ (PWA - ì„ íƒì‚¬í•­) -->
    <!-- <link rel="manifest" href="/manifest.json"> -->
</body>
</html>

